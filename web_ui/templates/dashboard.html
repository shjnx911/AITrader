{% extends "layout.html" %}

{% block title %}AITradeStrategist - Dashboard{% endblock %}

{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="row">
    <!-- Trading Summary Card -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Trading Summary</h5>
                <span class="badge bg-success">Active</span>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-6">
                        <div class="p-3 border rounded text-center bg-dark bg-opacity-50">
                            <h6 class="text-muted mb-1">Profit Today</h6>
                            <h4 class="mb-0 text-success">+2.3%</h4>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="p-3 border rounded text-center bg-dark bg-opacity-50">
                            <h6 class="text-muted mb-1">Active Trades</h6>
                            <h4 class="mb-0">3</h4>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="p-3 border rounded text-center bg-dark bg-opacity-50">
                            <h6 class="text-muted mb-1">Win Rate</h6>
                            <h4 class="mb-0">67%</h4>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="p-3 border rounded text-center bg-dark bg-opacity-50">
                            <h6 class="text-muted mb-1">Completed</h6>
                            <h4 class="mb-0">18</h4>
                        </div>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Daily Target</span>
                        <span>75%</span>
                    </div>
                    <div class="progress" style="height: 10px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 75%;" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI Model Performance Card -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">AI Model Performance</h5>
                <div class="dropdown">
                    <button class="btn btn-sm btn-dark dropdown-toggle" type="button" id="modelDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        Last 7 Days
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="modelDropdown">
                        <li><a class="dropdown-item" href="#">Today</a></li>
                        <li><a class="dropdown-item" href="#">Last 7 Days</a></li>
                        <li><a class="dropdown-item" href="#">Last 30 Days</a></li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Win Rate</th>
                                <th>Profit</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>BTC-LightGBM</td>
                                <td>73%</td>
                                <td class="text-success">+4.8%</td>
                                <td><span class="badge bg-success">Active</span></td>
                            </tr>
                            <tr>
                                <td>ETH-LightGBM</td>
                                <td>65%</td>
                                <td class="text-success">+2.3%</td>
                                <td><span class="badge bg-success">Active</span></td>
                            </tr>
                            <tr>
                                <td>XRP-Random Forest</td>
                                <td>58%</td>
                                <td class="text-danger">-0.5%</td>
                                <td><span class="badge bg-secondary">Paused</span></td>
                            </tr>
                            <tr>
                                <td>SOL-XGBoost</td>
                                <td>67%</td>
                                <td class="text-success">+3.1%</td>
                                <td><span class="badge bg-success">Active</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <a href="{{ url_for('models') }}" class="btn btn-outline-primary w-100 mt-2">View All Models</a>
            </div>
        </div>
    </div>
    
    <!-- System Resources Card -->
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">System Resources</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>CPU Usage</span>
                        <span id="cpuValue">32%</span>
                    </div>
                    <div class="progress" style="height: 10px;">
                        <div id="cpuProgress" class="progress-bar bg-primary" role="progressbar" style="width: 32%;" aria-valuenow="32" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Memory Usage</span>
                        <span id="memoryValue">67%</span>
                    </div>
                    <div class="progress" style="height: 10px;">
                        <div id="memoryProgress" class="progress-bar bg-warning" role="progressbar" style="width: 67%;" aria-valuenow="67" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>GPU Utilization</span>
                        <span id="gpuValue">45%</span>
                    </div>
                    <div class="progress" style="height: 10px;">
                        <div id="gpuProgress" class="progress-bar bg-success" role="progressbar" style="width: 45%;" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <div class="d-flex justify-content-between mb-1">
                        <span>Storage</span>
                        <span id="storageValue">28%</span>
                    </div>
                    <div class="progress" style="height: 10px;">
                        <div id="storageProgress" class="progress-bar bg-info" role="progressbar" style="width: 28%;" aria-valuenow="28" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
                <div class="d-flex justify-content-between mt-3">
                    <div>
                        <div class="d-flex align-items-center">
                            <div class="me-2" style="width: 12px; height: 12px; background-color: var(--bs-success); border-radius: 50%;"></div>
                            <small>Optimal</small>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex align-items-center">
                            <div class="me-2" style="width: 12px; height: 12px; background-color: var(--bs-warning); border-radius: 50%;"></div>
                            <small>Warning</small>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex align-items-center">
                            <div class="me-2" style="width: 12px; height: 12px; background-color: var(--bs-danger); border-radius: 50%;"></div>
                            <small>Critical</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Performance Charts Row -->
<div class="row mb-4">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Performance Over Time</h5>
                <div class="btn-group">
                    <button type="button" class="btn btn-sm btn-outline-secondary active" id="day">Day</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="week">Week</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" id="month">Month</button>
                </div>
            </div>
            <div class="card-body">
                <canvas id="performanceChart" height="250"></canvas>
            </div>
        </div>
    </div>
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Trading Distribution</h5>
            </div>
            <div class="card-body">
                <canvas id="tradingDistributionChart" height="250"></canvas>
                <div class="mt-3">
                    <div class="d-flex justify-content-between">
                        <div class="d-flex align-items-center">
                            <div class="me-2" style="width: 12px; height: 12px; background-color: var(--bs-success); border-radius: 50%;"></div>
                            <small>Profit (68%)</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="me-2" style="width: 12px; height: 12px; background-color: var(--bs-danger); border-radius: 50%;"></div>
                            <small>Loss (32%)</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Activity & Upcoming Actions Row -->
<div class="row">
    <div class="col-lg-8 mb-4">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Recent Trades</h5>
                <a href="#" class="btn btn-sm btn-outline-secondary">View All</a>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Pair</th>
                                <th>Type</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>Profit</th>
                                <th>Date</th>
                                <th>Model</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>BTC/USDT</td>
                                <td><span class="badge bg-success">Buy</span></td>
                                <td>67,245.80</td>
                                <td>69,423.15</td>
                                <td class="text-success">+3.24%</td>
                                <td>2024-04-15 08:15</td>
                                <td>BTC-LightGBM</td>
                            </tr>
                            <tr>
                                <td>ETH/USDT</td>
                                <td><span class="badge bg-danger">Sell</span></td>
                                <td>3,456.75</td>
                                <td>3,412.30</td>
                                <td class="text-success">+1.28%</td>
                                <td>2024-04-15 07:22</td>
                                <td>ETH-LightGBM</td>
                            </tr>
                            <tr>
                                <td>SOL/USDT</td>
                                <td><span class="badge bg-success">Buy</span></td>
                                <td>142.80</td>
                                <td>139.65</td>
                                <td class="text-danger">-2.21%</td>
                                <td>2024-04-15 06:58</td>
                                <td>SOL-XGBoost</td>
                            </tr>
                            <tr>
                                <td>BTC/USDT</td>
                                <td><span class="badge bg-success">Buy</span></td>
                                <td>66,890.45</td>
                                <td>67,245.80</td>
                                <td class="text-success">+0.53%</td>
                                <td>2024-04-15 04:30</td>
                                <td>BTC-LightGBM</td>
                            </tr>
                            <tr>
                                <td>XRP/USDT</td>
                                <td><span class="badge bg-danger">Sell</span></td>
                                <td>0.5120</td>
                                <td>0.5015</td>
                                <td class="text-success">+2.05%</td>
                                <td>2024-04-15 01:15</td>
                                <td>XRP-Random Forest</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4 mb-4">
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Trading Pairs</h5>
            </div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush">
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0">BTC/USDT</h6>
                                <small class="text-muted">Bitcoin</small>
                            </div>
                            <div class="text-end">
                                <div class="text-success mb-1">69,425.30 <small>+2.5%</small></div>
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success me-2">Buy</span>
                                    <small class="text-muted">Signal</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0">ETH/USDT</h6>
                                <small class="text-muted">Ethereum</small>
                            </div>
                            <div class="text-end">
                                <div class="text-danger mb-1">3,412.80 <small>-0.8%</small></div>
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-secondary me-2">Hold</span>
                                    <small class="text-muted">Signal</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0">SOL/USDT</h6>
                                <small class="text-muted">Solana</small>
                            </div>
                            <div class="text-end">
                                <div class="text-success mb-1">139.65 <small>+1.2%</small></div>
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-success me-2">Buy</span>
                                    <small class="text-muted">Signal</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0">XRP/USDT</h6>
                                <small class="text-muted">Ripple</small>
                            </div>
                            <div class="text-end">
                                <div class="text-danger mb-1">0.5015 <small>-1.5%</small></div>
                                <div class="d-flex align-items-center">
                                    <span class="badge bg-danger me-2">Sell</span>
                                    <small class="text-muted">Signal</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Upcoming Events</h5>
            </div>
            <div class="card-body p-0">
                <div class="list-group list-group-flush">
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <div>
                                <h6 class="mb-1">Model Retraining</h6>
                                <small class="text-muted">BTC-LightGBM scheduled update</small>
                            </div>
                            <small class="text-primary">Today</small>
                        </div>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <div>
                                <h6 class="mb-1">Performance Report</h6>
                                <small class="text-muted">Weekly analytics summary</small>
                            </div>
                            <small class="text-primary">Tomorrow</small>
                        </div>
                    </div>
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <div>
                                <h6 class="mb-1">System Maintenance</h6>
                                <small class="text-muted">Scheduled downtime: 30min</small>
                            </div>
                            <small class="text-primary">Apr 17</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Performance Chart
    const performanceCtx = document.getElementById('performanceChart').getContext('2d');
    const performanceChart = new Chart(performanceCtx, {
        type: 'line',
        data: {
            labels: ['Apr 8', 'Apr 9', 'Apr 10', 'Apr 11', 'Apr 12', 'Apr 13', 'Apr 14', 'Apr 15'],
            datasets: [{
                label: 'Profit %',
                data: [0, 1.2, 0.8, 1.5, 2.2, 1.9, 3.0, 3.8],
                borderColor: 'rgba(40, 167, 69, 1)',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                borderWidth: 2,
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false,
                        drawBorder: false
                    }
                },
                y: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.05)',
                    },
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });

    // Trading Distribution Chart
    const distributionCtx = document.getElementById('tradingDistributionChart').getContext('2d');
    const distributionChart = new Chart(distributionCtx, {
        type: 'doughnut',
        data: {
            labels: ['Profit', 'Loss'],
            datasets: [{
                data: [68, 32],
                backgroundColor: [
                    'rgba(40, 167, 69, 0.8)',
                    'rgba(220, 53, 69, 0.8)'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            cutout: '70%'
        }
    });

    // Toggle between time periods for performance chart
    document.getElementById('day').addEventListener('click', function() {
        setActiveButton(this);
        updatePerformanceChart('day');
    });
    
    document.getElementById('week').addEventListener('click', function() {
        setActiveButton(this);
        updatePerformanceChart('week');
    });
    
    document.getElementById('month').addEventListener('click', function() {
        setActiveButton(this);
        updatePerformanceChart('month');
    });
    
    function setActiveButton(button) {
        document.querySelectorAll('.btn-group .btn').forEach(btn => {
            btn.classList.remove('active');
        });
        button.classList.add('active');
    }
    
    function updatePerformanceChart(period) {
        let labels, data;
        
        if (period === 'day') {
            labels = ['9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00'];
            data = [0, 0.4, 0.3, 0.7, 1.1, 0.9, 1.5, 2.3];
        } else if (period === 'week') {
            labels = ['Apr 8', 'Apr 9', 'Apr 10', 'Apr 11', 'Apr 12', 'Apr 13', 'Apr 14', 'Apr 15'];
            data = [0, 1.2, 0.8, 1.5, 2.2, 1.9, 3.0, 3.8];
        } else {
            labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            data = [0, 2.5, 5.0, 8.5, 10.2, 12.8, 15.5, 18.2, 21.5, 25.0, 27.5, 30.0];
        }
        
        performanceChart.data.labels = labels;
        performanceChart.data.datasets[0].data = data;
        performanceChart.update();
    }
    
    // Resource usage update simulation
    function updateResources() {
        // Get random values
        const cpuValue = Math.floor(Math.random() * 40) + 20; // 20-60%
        const memoryValue = Math.floor(Math.random() * 30) + 50; // 50-80%
        const gpuValue = Math.floor(Math.random() * 50) + 20; // 20-70%
        const storageValue = Math.floor(Math.random() * 10) + 25; // 25-35%
        
        // Update DOM
        document.getElementById('cpuValue').textContent = cpuValue + '%';
        document.getElementById('cpuProgress').style.width = cpuValue + '%';
        document.getElementById('cpuProgress').setAttribute('aria-valuenow', cpuValue);
        
        document.getElementById('memoryValue').textContent = memoryValue + '%';
        document.getElementById('memoryProgress').style.width = memoryValue + '%';
        document.getElementById('memoryProgress').setAttribute('aria-valuenow', memoryValue);
        
        document.getElementById('gpuValue').textContent = gpuValue + '%';
        document.getElementById('gpuProgress').style.width = gpuValue + '%';
        document.getElementById('gpuProgress').setAttribute('aria-valuenow', gpuValue);
        
        document.getElementById('storageValue').textContent = storageValue + '%';
        document.getElementById('storageProgress').style.width = storageValue + '%';
        document.getElementById('storageProgress').setAttribute('aria-valuenow', storageValue);
        
        // Update color based on value
        document.getElementById('cpuProgress').className = 
            cpuValue > 80 ? 'progress-bar bg-danger' : 
            cpuValue > 60 ? 'progress-bar bg-warning' : 
            'progress-bar bg-success';
            
        document.getElementById('memoryProgress').className = 
            memoryValue > 80 ? 'progress-bar bg-danger' : 
            memoryValue > 60 ? 'progress-bar bg-warning' : 
            'progress-bar bg-success';
            
        document.getElementById('gpuProgress').className = 
            gpuValue > 80 ? 'progress-bar bg-danger' : 
            gpuValue > 60 ? 'progress-bar bg-warning' : 
            'progress-bar bg-success';
    }
    
    // Update resources every 5 seconds
    updateResources();
    setInterval(updateResources, 5000);
</script>
{% endblock %}